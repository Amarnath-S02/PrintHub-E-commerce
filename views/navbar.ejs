<section id="header">
    <a href="/"><img class="logo" src="./Assets/Printhub_logo.png"></a>
    <div>
        <ul id="navbar">
            <li><a href="/">Home</a></li>
            <li><a href="/shop">Shop</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
            <li>
                <a href="/cart" id="lg-bag"><i class="fal fa-shopping-bag" style="color: blueviolet"></i><span class="quantity" id="cart-count">0</span></a>
                
            </li>
            <li class="user-profile" id="userProfile">
                
                <i class="fa-regular fa-user profile-icon" id="lg-bag" style="color: blueviolet">
                    <span id="username"><%= username %></span>
                </i>
                    

                <div class="dropdown" id="dropdown">
                    <ul>
                        <li><a href="/order-history">Order History</a></li>
                        <li><a href="/logout">Logout</a></li>
                    </ul>
                </div>
            </li>
            <li><a href="#" id="close"><i class="fa-solid fa-xmark" style="color: blueviolet; font-size: 30px;"></i></a></li>
        </ul>
    </div>
    <div id="mobile">
    <a href="/cart" ><i class="fal fa-shopping-bag" style="color: blueviolet"></i></a>
    <i id="bar" class="fas fa-outdent"></i>
    </div>
    </section>

    <script>
        // Frontend JavaScript to fetch and update cart count
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // const username = '<%= username %>'; 
                         
                // const formattedUsername = encodeURIComponent(username);
                const response = await fetch('/cart-count');
                if (response.ok) {
                    const cartCount = await response.json();
                    updateCartCount(cartCount);
                } else {
                    console.error('Failed to fetch cart count');
                    // Handle error, display default count or retry logic
                }
            } catch (error) {
                console.error('Error fetching cart count:', error);
            }
        });
        
        function updateCartCount(count) {
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = count;
            }
        }
        

    document.addEventListener('DOMContentLoaded', function () {
        const userProfile = document.getElementById('userProfile');
        const dropdown = document.getElementById('dropdown');

        userProfile.addEventListener('click', function (event) {
            event.stopPropagation(); // Prevent the click event from bubbling up to document

            userProfile.classList.toggle('clicked');
            dropdown.style.display = userProfile.classList.contains('clicked') ? 'block' : 'none';
        });

        // Close the dropdown if user clicks outside of it
        document.addEventListener('click', function (event) {
            if (!userProfile.contains(event.target)) {
                userProfile.classList.remove('clicked');
                dropdown.style.display = 'none';
            }
        });
    });
</script>
        